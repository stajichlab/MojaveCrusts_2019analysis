library(dplyr)
library(scales)
library(grid)
library(reshape2)
library(phyloseq)
library(magrittr)
library(ggplot2)
library(ggpubr)
library(data.table)
library(tidyr)
library(tidyverse)
otu = read.table(file="MojaveBacQ2FWLEsilva515806.otu_table.fix.txt", header=T, sep='\t')
head(otu)
dim(otu)
tax <- read.table(file="taxonomy.fix.tsv", sep='\t', header=TRUE)
head(tax)
dim(tax)
tax_filtered <- tax[tax$OTU.ID %in% otu$OTU.ID,]
head(tax_filtered)
dim(tax_filtered)
dim(otu)
tax_filtered = tax_filtered[,c(1,2)]
tax_filtered = separate(tax_filtered, Taxon, c("Kingdom","Phylum","Class","Order", "Family", "Genus","Species"), sep= ";", remove=TRUE)
dim(tax_filtered)
head(tax_filtered)
write.csv(tax_filtered, file="taxonomy_phyloseq_fix.csv")
otus <- read.table("MojaveBacQ2FWLEsilva515806.otu_table.fix.txt",
header=T,sep="\t",row.names = 1)
otumat <- as(as.matrix(otus), "matrix")
OTU = otu_table(otumat, taxa_are_rows = TRUE)
taxmat <- read.csv("taxonomy_phyloseq_fix.csv",
sep=",",row.names=1)
row.names(taxmat) = taxmat$OTU.ID
taxmat <- as(as.matrix(taxmat),"matrix")
TAX = tax_table(taxmat)
treefile = "tree.nwk"
tree = read.tree(treefile)
meta = read.table("Mojave_mappingfile_8-Aug-2018.txt",
header=TRUE,row.names=1,
sep="\t",stringsAsFactors=FALSE)
#meta <- meta[which(meta$Layer %in% c("Surface")),]
head(meta)
sampleData <- sample_data(meta)
physeq = phyloseq(OTU,TAX,sampleData,tree)
physeq
physeq.prune = prune_taxa(taxa_sums(physeq) > 5, physeq)
physeq.prune
readcount = data.table(as(sample_data(physeq.prune), "data.frame"),
TotalReads = sample_sums(physeq.prune),
keep.rownames = TRUE)
setnames(readcount, "rn", "SampleID")
#For plotting, use command below.
#SeqDepth = ggplot(readcount, aes(TotalReads)) + geom_histogram() + ggtitle("Sequencing Depth")
readcount = readcount[order(readcount$TotalReads), c("SampleID", "TotalReads")]
head(readcount)
set.seed(711)
physeq.prune.rarefy = rarefy_even_depth(physeq.prune, sample.size = 37435, replace = FALSE, trimOTUs = TRUE)
physeq.prune.rarefy
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 1, physeq)
physeq.prune.x.ord <- ordinate(physeq.prune.x, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
physeq.prune.x.bray = prune_taxa(taxa_sums(physeq) > 5, physeq)
physeq.prune.x.ord.bray <- ordinate(physeq.prune.x.bray, "PCoA", "bray")
pssitelayer.bray = plot_ordination(physeq.prune.x.bray, physeq.prune.x.ord.bray, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer.bray
knitr::opts_chunk$set(echo = TRUE)
physeq.prune.x.bray = prune_taxa(taxa_sums(physeq) > 1, physeq)
physeq.prune.x.ord.bray <- ordinate(physeq.prune.x.bray, "NMDS", "unifrac")
pssitelayer.bray = plot_ordination(physeq.prune.x.bray, physeq.prune.x.ord.bray, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer.bray
physeq.prune.x.bray = prune_taxa(taxa_sums(physeq) > 1, physeq)
physeq.prune.x.ord.bray <- ordinate(physeq.prune.x.bray, "NMDS", "bray")
pssitelayer.bray = plot_ordination(physeq.prune.x.bray, physeq.prune.x.ord.bray, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer.bray
physeq.prune.x.bray = prune_taxa(taxa_sums(physeq) > 10, physeq)
physeq.prune.x.ord.bray <- ordinate(physeq.prune.x.bray, "NMDS", "bray")
pssitelayer.bray = plot_ordination(physeq.prune.x.bray, physeq.prune.x.ord.bray, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer.bray
physeq.prune.x.bray = prune_taxa(taxa_sums(physeq) > 100, physeq)
physeq.prune.x.ord.bray <- ordinate(physeq.prune.x.bray, "NMDS", "bray")
pssitelayer.bray = plot_ordination(physeq.prune.x.bray, physeq.prune.x.ord.bray, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer.bray
physeq.prune.x.bray = prune_taxa(taxa_sums(physeq) > 100, physeq)
physeq.prune.x.ord.bray <- ordinate(physeq.prune.x.bray, "NMDS")
pssitelayer.bray = plot_ordination(physeq.prune.x.bray, physeq.prune.x.ord.bray, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer.bray
physeq.prune.x.bray = prune_taxa(taxa_sums(physeq) > 1000, physeq)
physeq.prune.x.ord.bray <- ordinate(physeq.prune.x.bray, "NMDS")
pssitelayer.bray = plot_ordination(physeq.prune.x.bray, physeq.prune.x.ord.bray, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer.bray
physeq.prune.x.bray = prune_taxa(taxa_sums(physeq) > 1, physeq.prune.rarefy)
physeq.prune.x.bray = prune_taxa(taxa_sums(physeq) > 1, physeq.prune.rarefy)
#physeq.prune.x.bray = prune_taxa(taxa_sums(physeq) > 1, physeq.prune.rarefy)
physeq.prune.x.ord.bray <- ordinate(physeq.prune.rarefy, "NMDS", "bray")
pssitelayer.bray = plot_ordination(physeq.prune.x.bray, physeq.prune.x.ord.bray, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer.bray
#physeq.prune.x.bray = prune_taxa(taxa_sums(physeq) > 1, physeq.prune.rarefy)
physeq.prune.x.ord.bray <- ordinate(physeq.prune.rarefy, "NMDS", "unifrac")
pssitelayer.bray = plot_ordination(physeq.prune.x.bray, physeq.prune.x.ord.bray, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer.bray
pssitelayer.bray = plot_ordination(physeq.prune.x.bray, physeq.prune.x.ord.bray, type = "samples", color = "Crust_type")  + theme_bw() + ggtitle("Bacterial Beta Diversity (NMDS) by Crust type") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer.bray
pssitelayer.bray = plot_ordination(physeq.prune.x.bray, physeq.prune.x.ord.bray, type = "samples", color = "Crust_type")  + theme_bw() + ggtitle("Bacterial Beta Diversity (NMDS) by Crust type") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Crust_type))
pssitelayer.bray
pssitelayer.bray = plot_ordination(physeq.prune.x.bray, physeq.prune.x.ord.bray, type = "samples", color = "Crust_type")  + theme_bw() + ggtitle("Bacterial Beta Diversity (NMDS) by Crust type") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Layer))
pssitelayer.bray
pssitelayer.bray = plot_ordination(physeq.prune.x.bray, physeq.prune.x.ord.bray, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Layer))
pssitelayer.bray
pssitelayer.bray = plot_ordination(physeq.prune.x.bray, physeq.prune.x.ord.bray, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Layer), type = "norm")
pssitelayer.bray
pssitelayer.bray = plot_ordination(physeq.prune.x.bray, physeq.prune.x.ord.bray, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Layer), type = "t")
pssitelayer.bray
#physeq.prune.x.bray = prune_taxa(taxa_sums(physeq) > 1, physeq.prune.rarefy)
physeq.prune.x.ord.bray <- ordinate(physeq.prune.rarefy, "PCoA", "unifrac")
pssitelayer.bray = plot_ordination(physeq.prune.x.bray, physeq.prune.x.ord.bray, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Layer))
pssitelayer.bray
#physeq.prune.x.bray = prune_taxa(taxa_sums(physeq) > 1, physeq.prune.rarefy)
physeq.prune.x.ord.bray <- ordinate(physeq.prune, "PCoA", "unifrac")
pssitelayer.bray = plot_ordination(physeq.prune.x.bray, physeq.prune.x.ord.bray, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Layer))
pssitelayer.bray
physeq.prune.x.ord.bray <- ordinate(physeq.prune, "NMDS", "unifrac")
pssitelayer.bray = plot_ordination(physeq.prune.x.bray, physeq.prune.x.ord.bray, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Layer))
pssitelayer.bray
physeq.prune.x.ord.bray <- ordinate(physeq.prune.rarefy, "NMDS", "unifrac")
pssitelayer.bray = plot_ordination(physeq.prune.x.bray, physeq.prune.x.ord.bray, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Layer))
pssitelayer.bray
pssitelayer.bray = plot_ordination(physeq.prune.x.bray, physeq.prune.x.ord.bray, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site))
pssitelayer.bray
physeq.prune.x.ord.bray <- ordinate(physeq.prune.rarefy, "NMDS", "bray")
pssitelayer.bray = plot_ordination(physeq.prune.x.bray, physeq.prune.x.ord.bray, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site))
pssitelayer.bray
physeq.prune.x.ord <- ordinate(physeq.prune, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune, physeq.prune.x.ord, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
physeq.prune.x.ord <- ordinate(physeq, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq, physeq.prune.x.ord, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
physeq.prune.x.ord <- ordinate(physeq.prune.rarefy, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune.rarefy, physeq.prune.x.ord, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 10, physeq)
physeq.prune.x.ord <- ordinate(physeq.prune.x, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 100, physeq)
physeq.prune.x.ord <- ordinate(physeq.prune.x, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 15, physeq)
physeq.prune.x.ord <- ordinate(physeq.prune.x, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 10, physeq)
physeq.prune.x.ord <- ordinate(physeq.prune.x, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
ps.dist = phyloseq::distance(physeq.prune.x, "unifrac")
adonis(ps.dist ~ Site_Layer, as(sample_data(physeq.prune.x),"data.frame"))
adonis(ps.dist ~ Site_layer, as(sample_data(physeq.prune.x),"data.frame"))
adonis(ps.dist ~ Crust_type, as(sample_data(physeq.prune.x),"data.frame"))
pscrusttype = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Crust_type")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Crust type") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Layer))
pscrusttype
pdf("./Figures/Bacterial Beta Diversity (PCoA) by Site and Layer.pdf" )
pssitelayer
dev.off()
pdf("./Figures/Bacterial Beta Diversity (PCoA) by Crust type.pdf" )
pscrusttype
dev.off()
pscrusttype = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Crust_type")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Crust type") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Layer)) + annotate("text", x = -0.15, y = 0.3, label = "PERMANOVA, p = 0.001")
pscrusttype
pscrusttype = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Crust_type")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Crust type") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Layer)) + annotate("text", x = -0.15, y = 0.51, label = "PERMANOVA, p = 0.001")
pscrusttype
pscrusttype = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Crust_type")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Crust type") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Layer)) + annotate("text", x = -0.15, y = 0.52, label = "PERMANOVA, p = 0.001")
pscrusttype
pscrusttype = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Crust_type")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Crust type") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Layer)) + annotate("text", x = -0.15, y = 0.54, label = "PERMANOVA, p = 0.001")
pscrusttype
pdf("./Figures/Bacterial Beta Diversity (PCoA) by Crust type.pdf" )
pscrusttype
dev.off()
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.15, y = 0.54, label = "PERMANOVA, p = 0.001")
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.15, y = 0.48, label = "PERMANOVA, p = 0.001")
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.15, y = 0.3, label = "PERMANOVA, p = 0.001")
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.15, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.5, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
pscrusttype = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Crust_type")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Crust type") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Layer)) + annotate("text", x = -0.3, y = 0.54, label = "PERMANOVA, p = 0.001")
pscrusttype
pdf("./Figures/Bacterial Beta Diversity (PCoA) by Crust type.pdf" )
pscrusttype
dev.off()
pdf("./Figures/Bacterial Beta Diversity (PCoA) by Site and Layer.pdf" )
pssitelayer
dev.off()
knitr::opts_chunk$set(echo = TRUE)
library(ape)
library(vegan)
library(plyr)
library(dplyr)
library(scales)
library(grid)
library(reshape2)
library(phyloseq)
library(magrittr)
library(ggplot2)
library(ggpubr)
library(data.table)
library(tidyr)
library(tidyverse)
otu = read.table(file="MojaveBacQ2FWLEsilva515806.otu_table.fix.txt", header=T, sep='\t')
dim(otu)
tax <- read.table(file="taxonomy.fix.tsv", sep='\t', header=TRUE)
head(tax)
dim(tax)
tax_filtered <- tax[tax$OTU.ID %in% otu$OTU.ID,]
head(tax_filtered)
dim(tax_filtered)
dim(otu)
tax_filtered = tax_filtered[,c(1,2)]
tax_filtered = separate(tax_filtered, Taxon, c("Kingdom","Phylum","Class","Order", "Family", "Genus","Species"), sep= ";", remove=TRUE)
dim(tax_filtered)
head(tax_filtered)
write.csv(tax_filtered, file="taxonomy_phyloseq_fix.csv")
otus <- read.table("MojaveBacQ2FWLEsilva515806.otu_table.fix.txt",
header=T,sep="\t",row.names = 1)
otumat <- as(as.matrix(otus), "matrix")
OTU = otu_table(otumat, taxa_are_rows = TRUE)
taxmat <- read.csv("taxonomy_phyloseq_fix.csv",
sep=",",row.names=1)
row.names(taxmat) = taxmat$OTU.ID
taxmat <- as(as.matrix(taxmat),"matrix")
TAX = tax_table(taxmat)
treefile = "tree.nwk"
tree = read.tree(treefile)
meta = read.table("Mojave_mappingfile_8-Aug-2018.txt",
header=TRUE,row.names=1,
sep="\t",stringsAsFactors=FALSE)
#meta <- meta[which(meta$Layer %in% c("Surface")),]
sampleData <- sample_data(meta)
sampleData <- sample_data(meta)
physeq = phyloseq(OTU,TAX,sampleData,tree)
physeq
physeq.prune = prune_taxa(taxa_sums(physeq) > 5, physeq)
physeq.prune
readcount = data.table(as(sample_data(physeq.prune), "data.frame"),
TotalReads = sample_sums(physeq.prune),
keep.rownames = TRUE)
setnames(readcount, "rn", "SampleID")
#For plotting, use command below.
#SeqDepth = ggplot(readcount, aes(TotalReads)) + geom_histogram() + ggtitle("Sequencing Depth")
readcount = readcount[order(readcount$TotalReads), c("SampleID", "TotalReads")]
head(readcount)
set.seed(711)
physeq.prune.rarefy = rarefy_even_depth(physeq.prune, sample.size = 37435, replace = FALSE, trimOTUs = TRUE)
physeq.prune.rarefy
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 10, physeq)
physeq.prune.x.ord <- ordinate(physeq.prune.x, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
ps.dist = phyloseq::distance(physeq.prune.x, "unifrac")
adonis(ps.dist ~ Site, as(sample_data(physeq.prune.x),"data.frame"))
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 10, physeq)
physeq.prune.x.SF = subset_samples(physeq.prune.x, Layer=="Surface")
physeq.prune.x.ord <- ordinate(physeq.prune.x.SF, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x.SF, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 15, physeq)
physeq.prune.x.SF = subset_samples(physeq.prune.x, Layer=="Surface")
physeq.prune.x.ord <- ordinate(physeq.prune.x.SF, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x.SF, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 5, physeq)
physeq.prune.x.SF = subset_samples(physeq.prune.x, Layer=="Surface")
physeq.prune.x.ord <- ordinate(physeq.prune.x.SF, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x.SF, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 5, physeq)
physeq.prune.x.SF = subset_samples(physeq.prune.x, Layer=="Surface")
physeq.prune.x.ord <- ordinate(physeq.prune.x.SF, "NMDS", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x.SF, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x.SF, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site))
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 5, physeq)
physeq.prune.x.SF = subset_samples(physeq.prune.x, Layer=="Surface")
physeq.prune.x.ord <- ordinate(physeq.prune.x.SF, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x.SF, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site))
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 10, physeq)
physeq.prune.x.SF = subset_samples(physeq.prune.x, Layer=="Surface")
physeq.prune.x.ord <- ordinate(physeq.prune.x.SF, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x.SF, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x.SF, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 10, physeq)
physeq.prune.x.SF = subset_samples(physeq.prune.x, Layer=="Surface")
physeq.prune.x.ord <- ordinate(physeq.prune.x.SF, "NMDS", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x.SF, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x.SF, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site))
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 10, physeq)
physeq.prune.x.SF = subset_samples(physeq.prune.x, Layer=="Surface")
physeq.prune.x.ord <- ordinate(physeq.prune.x.SF, "NMDS", "bray")
pssitelayer = plot_ordination(physeq.prune.x.SF, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x.SF, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 10, physeq)
physeq.prune.x.SF = subset_samples(physeq.prune.x, Layer=="Surface")
physeq.prune.x.ord <- ordinate(physeq.prune.x.SF, "NMDS", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x.SF, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 10, physeq)
physeq.prune.x.SF = subset_samples(physeq.prune.x, Layer=="Surface")
physeq.prune.x.ord <- ordinate(physeq.prune.x.SF, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x.SF, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x.SF, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x.SF, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site))
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 10, physeq)
#physeq.prune.x.SF = subset_samples(physeq.prune.x, Layer=="Surface")
physeq.prune.x.ord <- ordinate(physeq.prune.x, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 10, physeq)
#physeq.prune.x.SF = subset_samples(physeq.prune.x, Layer=="Surface")
physeq.prune.x.ord <- ordinate(physeq.prune.x, "NMDS", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 10, physeq)
#physeq.prune.x.SF = subset_samples(physeq.prune.x, Layer=="Surface")
physeq.prune.x.ord <- ordinate(physeq.prune.x, "NMDS", "bray")
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 10, physeq)
#physeq.prune.x.SF = subset_samples(physeq.prune.x, Layer=="Surface")
physeq.prune.x.ord <- ordinate(physeq.prune.x, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + geom_polygon(aes(fill=Site_layer))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + geom_polygon(aes(fill=Site_layer))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + geom_polygon(aes(fill=Site_layer))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site", shape = "Layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site", shape = "Layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site))
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 10, physeq)
#physeq.prune.x.SF = subset_samples(physeq.prune.x, Layer=="Surface")
physeq.prune.x.ord <- ordinate(physeq.prune.x, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site", shape = "Layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site", shape = "Layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + stat_ellipse(geom = "polygon", type = "norm", alpha = 1/12, aes(fill = Site))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site", shape = "Layer")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 15, physeq)
#physeq.prune.x.SF = subset_samples(physeq.prune.x, Layer=="Surface")
physeq.prune.x.ord <- ordinate(physeq.prune.x, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + geom_point(size=5) #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + geom_point(size=5) + + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7") #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + geom_point(size=5) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7") #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + geom_point(size=5) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7")) #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001") + geom_point(size=5) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7")) + theme_grey() #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.3, y = 0.3, label = "PERMANOVA, p = 0.001") + geom_point(size=5) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7")) + theme_grey() #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.25, y = 0.3, label = "PERMANOVA, p = 0.001") + geom_point(size=5) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7")) + theme_grey() #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.25, y = 0.28, label = "PERMANOVA, p = 0.001") + geom_point(size=5) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7")) + theme_grey() #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site") + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.25, y = 0.28, label = "PERMANOVA, p = 0.001") + geom_point(size=5) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7")) #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site") + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.25, y = 0.28, label = "PERMANOVA, p = 0.001") + geom_point(size=3) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7")) #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site") + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.25, y = 0.28, label = "PERMANOVA, p = 0.001") + geom_point(size=4) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7")) #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
sample_data(physeq.prune.x)$Site = factor(sample_data(physeq.prune.x)$Site, levels = c("JTNP","CIMA", "GMT", "KELSO"))
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site") + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.25, y = 0.28, label = "PERMANOVA, p = 0.001") + geom_point(size=4) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7")) #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site") + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.25, y = 0.28, label = "PERMANOVA, p = 0.001") + geom_point(size=5) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7")) #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
pdf("./Figures/Bacterial Beta Diversity (PCoA) by Site PLPA250.pdf" )
pssitelayer
dev.off()
pdf("./Figures/Bacterial Beta Diversity (PCoA) by Site PLPA250.pdf", width = 8, height = 5 )
pssitelayer
dev.off()
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site", shape = "Layer") + ggtitle("Bacterial Beta Diversity (PCoA) by Site") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.25, y = 0.28, label = "PERMANOVA, p = 0.001") + geom_point(size=5) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7")) #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
pdf("./Figures/Bacterial Beta Diversity (PCoA) by Site (w Layer as shape)PLPA250.pdf", width = 8, height = 5 )
pssitelayer
dev.off()
knitr::opts_chunk$set(echo = TRUE)
library(ape)
library(vegan)
library(plyr)
library(dplyr)
library(scales)
library(grid)
library(reshape2)
library(phyloseq)
library(magrittr)
library(ggplot2)
library(ggpubr)
library(data.table)
library(tidyr)
library(tidyverse)
otu = read.table(file="MojaveBacQ2FWLEsilva515806.otu_table.fix.txt", header=T, sep='\t')
tax <- read.table(file="taxonomy.fix.tsv", sep='\t', header=TRUE)
head(tax)
dim(tax)
tax_filtered <- tax[tax$OTU.ID %in% otu$OTU.ID,]
head(tax_filtered)
tax_filtered = tax_filtered[,c(1,2)]
tax_filtered = separate(tax_filtered, Taxon, c("Kingdom","Phylum","Class","Order", "Family", "Genus","Species"), sep= ";", remove=TRUE)
dim(tax_filtered)
head(tax_filtered)
write.csv(tax_filtered, file="taxonomy_phyloseq_fix.csv")
otus <- read.table("MojaveBacQ2FWLEsilva515806.otu_table.fix.txt",
header=T,sep="\t",row.names = 1)
otumat <- as(as.matrix(otus), "matrix")
OTU = otu_table(otumat, taxa_are_rows = TRUE)
taxmat <- read.csv("taxonomy_phyloseq_fix.csv",
sep=",",row.names=1)
row.names(taxmat) = taxmat$OTU.ID
taxmat <- as(as.matrix(taxmat),"matrix")
TAX = tax_table(taxmat)
treefile = "tree.nwk"
tree = read.tree(treefile)
meta = read.table("Mojave_mappingfile_8-Aug-2018.txt",
header=TRUE,row.names=1,
sep="\t",stringsAsFactors=FALSE)
#meta <- meta[which(meta$Layer %in% c("Surface")),]
sampleData <- sample_data(meta)
physeq = phyloseq(OTU,TAX,sampleData,tree)
physeq
physeq.prune = prune_taxa(taxa_sums(physeq) > 5, physeq)
physeq.prune
readcount = data.table(as(sample_data(physeq.prune), "data.frame"),
TotalReads = sample_sums(physeq.prune),
keep.rownames = TRUE)
setnames(readcount, "rn", "SampleID")
#For plotting, use command below.
#SeqDepth = ggplot(readcount, aes(TotalReads)) + geom_histogram() + ggtitle("Sequencing Depth")
readcount = readcount[order(readcount$TotalReads), c("SampleID", "TotalReads")]
head(readcount)
set.seed(711)
physeq.prune.rarefy = rarefy_even_depth(physeq.prune, sample.size = 37435, replace = FALSE, trimOTUs = TRUE)
physeq.prune.rarefy
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 15, physeq)
#physeq.prune.x.SF = subset_samples(physeq.prune.x, Layer=="Surface")
physeq.prune.x.ord <- ordinate(physeq.prune.x, "PCoA", "unifrac")
sample_data(physeq.prune.x)$Crust_type = factor(sample_data(physeq.prune.x)$Crust_type, levels = c("LAC","CLC", "GLC", "RMC", "SMC"))
pscrusttype = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Crust_type") + ggtitle("Bacterial Beta Diversity (PCoA) by Crust_type") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.25, y = 0.28, label = "PERMANOVA, p = 0.001") + geom_point(size=5) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7")) #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pssitelayer
pscrusttype = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Crust_type") + ggtitle("Bacterial Beta Diversity (PCoA) by Crust_type") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.25, y = 0.28, label = "PERMANOVA, p = 0.001") + geom_point(size=5) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7")) #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pscrusttype
set.seed(711)
physeq.prune.rarefy = rarefy_even_depth(physeq.prune, sample.size = 37435, replace = FALSE, trimOTUs = TRUE)
physeq.prune.rarefy
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 15, physeq)
#physeq.prune.x.SF = subset_samples(physeq.prune.x, Layer=="Surface")
physeq.prune.x.ord <- ordinate(physeq.prune.x, "PCoA", "unifrac")
pscrusttype = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Crust_type") + ggtitle("Bacterial Beta Diversity (PCoA) by Crust_type") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.25, y = 0.28, label = "PERMANOVA, p = 0.001") + geom_point(size=5) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "#999999")) #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pscrusttype
pscrusttype = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Crust_type") + ggtitle("Bacterial Beta Diversity (PCoA) by Crust_type") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.25, y = 0.28, label = "PERMANOVA, p = 0.001") + geom_point(size=5) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7","#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7" )) #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pscrusttype
sample_data(physeq.prune.x)$Crust_type = factor(sample_data(physeq.prune.x)$Crust_type, levels = c("LAC","CLC", "GLC", "RMC", "SMC", "LAC.Sub","CLC.Sub", "GLC.Sub", "RMC.Sub", "SMC.Sub"))
pscrusttype = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Crust_type") + ggtitle("Bacterial Beta Diversity (PCoA) by Crust_type") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.25, y = 0.28, label = "PERMANOVA, p = 0.001") + geom_point(size=5) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7", )) #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pscrusttype = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Crust_type") + ggtitle("Bacterial Beta Diversity (PCoA) by Crust_type") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.25, y = 0.28, label = "PERMANOVA, p = 0.001") + geom_point(size=5) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7", "#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7")) #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pscrusttype
pscrusttype = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Crust_type", shape = "Layer") + ggtitle("Bacterial Beta Diversity (PCoA) by Crust_type") + theme(plot.title = element_text(hjust = 0.5)) + annotate("text", x = -0.25, y = 0.28, label = "PERMANOVA, p = 0.001") + geom_point(size=5) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7", "#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7")) #+ stat_ellipse(geom = "polygon", type = "t", alpha = 1/12, aes(fill = Site_layer))
pscrusttype
pdf("./Figures/Bacterial Beta Diversity (PCoA) by Crust type PLPA250.pdf" )
pscrusttype
dev.off()
pdf("./Figures/Bacterial Beta Diversity (PCoA) by Crust type PLPA250.pdf", width = 8, height = 5 )
pscrusttype
dev.off()
