knitr::opts_chunk$set(echo = TRUE)
library(ape)
library(vegan)
library(dplyr)
library(scales)
library(grid)
library(reshape2)
library(phyloseq)
library(magrittr)
library(ggplot2)
library(ggpubr)
library(plyr)
library(data.table)
library(tidyr)
library(tidyverse)
head(meta)
meta = read.table("Mojave_mappingfile_8-Aug-2018.txt",header=TRUE,row.names=1,sep="\t",stringsAsFactors=FALSE)
head(meta)
sampleData <- sample_data(meta)
otus <- read.table("MC2018FC.otu_table.txt",header=T,sep="\t",row.names=1)
otumat <- as(as.matrix(otus), "matrix")
OTU = otu_table(otumat, taxa_are_rows = TRUE)
head(OTU)
taxmat <- read.table("MC2018FC.taxonomy.fix.txt", header=T,sep="\t",row.names=1)
taxmat <- as(as.matrix(taxmat),"matrix")
TAX = tax_table(taxmat)
treefile = "MC2018FC.tree.phy"
tree = read.tree(treefile)
physeq = phyloseq(OTU,TAX,sampleData,tree)
physeq
physeq.prune = prune_taxa(taxa_sums(physeq) > 1, physeq)
physeq.prune
readcount = data.table(as(sample_data(physeq.prune), "data.frame"),
TotalReads = sample_sums(physeq.prune),
keep.rownames = TRUE)
setnames(readcount, "rn", "SampleID")
#For plotting, use command below.
#SeqDepth = ggplot(readcount, aes(TotalReads)) + geom_histogram() + ggtitle("Sequencing Depth")
readcount = readcount[order(readcount$TotalReads), c("SampleID", "TotalReads")]
head(readcount)
head(readcount)
set.seed(1)
physeq.prune.rarefy = rarefy_even_depth(physeq.prune, sample.size = 6842, replace = FALSE, trimOTUs = FALSE)
physeq.prune.rarefy
ps.dist = phyloseq::distance(physeq.prune, "bray")
adonis(ps.dist ~ Site_layer, as(sample_data(physeq.prune),"data.frame"))
adonis(ps.dist ~ Crust_type, as(sample_data(physeq.prune),"data.frame"))
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer = plot_ordination(physeq.prune, physeq.prune.x.ord, type = "samples", color = "Site_layer")  + theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer = plot_ordination(physeq.prune, physeq.prune.x.ord, type = "samples", color = "Site_layer") + theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer = plot_ordination(physeq.prune, physeq.prune.x.ord, type = "samples", color = "Site_layer") #+ theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
#physeq.prune.x = prune_taxa(taxa_sums(physeq) > 10, physeq)
physeq.prune.x.ord <- ordinate(physeq.prune, "PCoA", "bray")
pssitelayer = plot_ordination(physeq.prune, physeq.prune.x.ord, type = "samples", color = "Site_layer") #+ theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
pssitelayer = plot_ordination(physeq.prune, physeq.prune.x.ord, type = "samples", color = "Site_layer") + theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
#physeq.prune.x = prune_taxa(taxa_sums(physeq) > 10, physeq)
physeq.prune.x.ord <- ordinate(physeq.prune.rarefy, "PCoA", "bray")
pssitelayer = plot_ordination(physeq.prune, physeq.prune.x.ord, type = "samples", color = "Site_layer") + theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 1, physeq)
physeq.prune.x.ord <- ordinate(physeq.prune.x, "PCoA", "bray")
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer") + theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 1, physeq)
physeq.prune.x.ord <- ordinate(physeq.prune.x, "NMDS", "bray")
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer") + theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 1, physeq)
physeq.prune.x.ord <- ordinate(physeq.prune.x, "NMDS", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer") + theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq) > 1, physeq)
physeq.prune.x.ord <- ordinate(physeq.prune.x, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer") + theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
physeq.prune.x = prune_taxa(taxa_sums(physeq.prune.rarefy) > 1, physeq.prune.rarefy)
physeq.prune.x.ord <- ordinate(physeq.prune.x, "PCoA", "bray")
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer") + theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer") + theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) #+ stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
#physeq.prune.x = prune_taxa(taxa_sums(physeq.prune.rarefy) > 1, physeq.prune.rarefy)
physeq.prune.x.ord <- ordinate(physeq.prune.rarefy, "PCoA", "bray")
pssitelayer = plot_ordination(physeq.prune.rarefy, physeq.prune.x.ord, type = "samples", color = "Site_layer") + theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) #+ stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
pssitelayer = plot_ordination(physeq.prune.rarefy, physeq.prune.x.ord, type = "samples", color = "Site_layer") + theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
pscrusttype = plot_ordination(physeq.prune.rarefy, physeq.prune.x.ord, type = "samples", color = "Crust_type")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Crust type") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Layer)) + annotate("text", x = -0.3, y = 0.54, label = "PERMANOVA, p = 0.001")
pscrusttype
#physeq.prune.x = prune_taxa(taxa_sums(physeq.prune.rarefy) > 1, physeq.prune.rarefy)
physeq.prune.x.ord <- ordinate(physeq.prune.rarefy, "PCoA", "unifrac")
pscrusttype = plot_ordination(physeq.prune.rarefy, physeq.prune.x.ord, type = "samples", color = "Crust_type")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Crust type") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Layer)) + annotate("text", x = -0.3, y = 0.54, label = "PERMANOVA, p = 0.001")
pscrusttype
pssitelayer = plot_ordination(physeq.prune.rarefy, physeq.prune.x.ord, type = "samples", color = "Site_layer") + theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.38, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
ps.dist = phyloseq::distance(physeq.prune, "unifrac")
adonis(ps.dist ~ Site_layer, as(sample_data(physeq.prune),"data.frame"))
adonis(ps.dist ~ Crust_type, as(sample_data(physeq.prune),"data.frame"))
pssitelayer = plot_ordination(physeq.prune.rarefy, physeq.prune.x.ord, type = "samples", color = "Site_layer") + theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.3, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
pscrusttype = plot_ordination(physeq.prune.rarefy, physeq.prune.x.ord, type = "samples", color = "Crust_type")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Crust type") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Layer)) + annotate("text", x = -0.38, y = 0.54, label = "PERMANOVA, p = 0.001")
pscrusttype
physeq.prune.x = prune_taxa(taxa_sums(physeq.prune.rarefy) > 5, physeq.prune.rarefy)
physeq.prune.x.ord <- ordinate(physeq.prune.x, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer") + theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.3, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
pscrusttype = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Crust_type")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Crust type") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Layer)) + annotate("text", x = -0.38, y = 0.54, label = "PERMANOVA, p = 0.001")
pscrusttype
physeq.prune.x = prune_taxa(taxa_sums(physeq.prune.rarefy) > 10, physeq.prune.rarefy)
physeq.prune.x.ord <- ordinate(physeq.prune.x, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer") + theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.3, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
pscrusttype = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Crust_type")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Crust type") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Layer)) + annotate("text", x = -0.38, y = 0.54, label = "PERMANOVA, p = 0.001")
pscrusttype
physeq.prune.x = prune_taxa(taxa_sums(physeq.prune.rarefy) > 1, physeq.prune.rarefy)
physeq.prune.x.ord <- ordinate(physeq.prune.x, "PCoA", "unifrac")
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Site_layer") + theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.3, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
pscrusttype = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "samples", color = "Crust_type")  + theme_bw() + ggtitle("Bacterial Beta Diversity (PCoA) by Crust type") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Layer)) + annotate("text", x = -0.38, y = 0.54, label = "PERMANOVA, p = 0.001")
pscrusttype
pdf("./Figures/Fungal Beta Diversity (PCoA) by Site and Layer.pdf")
pdf("./Figures/Fungal Beta Diversity (PCoA) by Site and Layer.pdf")
pssitelayer
dev.off()
pdf("./Figures/Fungal Beta Diversity (PCoA) by Crust type.pdf")
pscrusttype
dev.off()
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "taxa", color = "Site_layer") + theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.3, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "taxa", ) + theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.3, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
pssitelayer = plot_ordination(physeq.prune.x, physeq.prune.x.ord, type = "taxa", ) #+ theme_bw() + ggtitle("Fungal Beta Diversity (PCoA) by Site and Layer") + theme(plot.title = element_text(hjust = 0.5)) + stat_ellipse(geom = "polygon", alpha = 1/12, aes(fill = Site_layer)) + annotate("text", x = -0.3, y = 0.38, label = "PERMANOVA, p = 0.001")
pssitelayer
