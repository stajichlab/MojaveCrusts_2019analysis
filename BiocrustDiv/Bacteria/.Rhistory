data_glom.bac$Phylum[data_glom.bac$Abundance < 0.003] <- "<1% abund."
Count = length(unique(data_glom.bac$Phylum))
Count
Count = length(unique(data_glom.bac$Phylum))
Count
unique((data_glom.bac$Phylum))
data_glom.bac$Phylum <- factor(data_glom.bac$Phylum, levels = c("D_1__Cyanobacteria", "D_1__Proteobacteria","D_1__Actinobacteria","Unknown", "D_1__Thaumarchaeota","D_1__Acidobacteria","D_1__Chloroflexi", "D_1__Verrucomicrobia","<1% abund."))
taxcom_layer = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_manual(values = c("brown","coral1","goldenrod","khaki1","lightgreen","darkturquoise","lightblue","midnightblue","aquamarine4","lavenderblush2","hotpink2", "snow3")
print(taxcom_layer)
taxcom_layer = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_manual(values = c("brown","coral1","goldenrod","khaki1","lightgreen","darkturquoise","lightblue","midnightblue","aquamarine4","lavenderblush2","hotpink2", "snow3"))
print(taxcom_layer)
data_glom.bac <- data_glom.bac.arc
data_glom.bac$Phylum[data_glom.bac$Abundance < 0.002] <- "<1% abund."
Count = length(unique(data_glom.bac$Phylum))
Count
unique((data_glom.bac$Phylum))
data_glom.bac$Phylum <- factor(data_glom.bac$Phylum, levels = c("D_1__Cyanobacteria", "D_1__Proteobacteria","D_1__Actinobacteria","Unknown", "D_1__Thaumarchaeota","D_1__Acidobacteria","D_1__Chloroflexi", "D_1__Verrucomicrobia","D_1__Nitrospirae","D_1__FBP","<1% abund."))
taxcom_layer = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_manual(values = c("brown","coral1","goldenrod","khaki1","lightgreen","darkturquoise","lightblue","midnightblue","aquamarine4","lavenderblush2","hotpink2", "snow3"))
print(taxcom_layer)
rank.names(bac.abund)
rank.names(bac.abund)
rank_names(bac.abund)
TAX.bac <- tax_table(tax.bac)
bac.3 <- phyloseq(sample_data(physeq.prune.rarefy),otu_table(physeq.prune.rarefy),TAX.bac)
bac.3
glom.bac <- tax_glom(bac.3,taxrank = "Phylum")
glom.bac
physeq.prune.rarefy = prune_taxa(taxa_sums(physeq.prune.rarefy) > 20, physeq.prune.rarefy)
physeq.prune.rarefy
physeq.prune.rarefy = prune_taxa(taxa_sums(physeq.prune.rarefy) > 50, physeq.prune.rarefy)
physeq.prune.rarefy
physeq.prune.rarefy = prune_taxa(taxa_sums(physeq.prune.rarefy) > 100, physeq.prune.rarefy)
physeq.prune.rarefy
glom.bac <- tax_glom(physeq.prune.rarefy,taxrank = "Phylum")
glom.bac
glom.bac <- tax_glom(physeq.prune.rarefy,taxrank = "Class")
glom.bac
tax_table(glom.bac)
TAX.bac <- tax_table(tax.bac)
bac.3 <- phyloseq(sample_data(physeq.prune.rarefy),otu_table(physeq.prune.rarefy),TAX.bac$Phylum)
TAX.bac <- tax_table(tax.bac$Phylum)
tax.bac$Phylum
TAX.bac$Phylum
str(tax.bac)
head(TAX)
taxmat <- read.csv("taxonomy_phyloseq_fix_copy.csv",
sep=",",row.names=1)
#row.names(taxmat) = taxmat$OTU.ID
taxmat <- as(as.matrix(taxmat),"matrix")
TAX = tax_table(taxmat)
head(TAX)
physeq = phyloseq(OTU,TAX,sampleData,tree)
physeq
physeq.prune = prune_taxa(taxa_sums(physeq) > 5, physeq)
physeq.prune
readcount = data.table(as(sample_data(physeq.prune), "data.frame"),
TotalReads = sample_sums(physeq.prune),
keep.rownames = TRUE)
setnames(readcount, "rn", "SampleID")
#For plotting, use command below.
#SeqDepth = ggplot(readcount, aes(TotalReads)) + geom_histogram() + ggtitle("Sequencing Depth")
readcount = readcount[order(readcount$TotalReads), c("SampleID", "TotalReads")]
head(readcount)
set.seed(711)
physeq.prune.rarefy = rarefy_even_depth(physeq.prune, sample.size = 37435, replace = FALSE, trimOTUs = TRUE)
physeq.prune.rarefy
physeq.prune.rarefy
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "Rhizaria")
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "Chromista")
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "D_0__Eukaryota")
physeq.prune.rarefy
sample_data(physeq.prune.rarefy)$Layer = factor(sample_data(physeq.prune.rarefy)$Layer, levels = c("Surface", "Subsurface"))
tax.bac <- as(tax_table(physeq.prune.rarefy),"matrix")
head(tax.bac)
tax.bac[is.na(tax.bac)] <- "Unknown"
head(tax.bac)
TAX.bac <- tax_table(tax.bac)
bac.3 <- phyloseq(sample_data(physeq.prune.rarefy),otu_table(physeq.prune.rarefy),TAX.bac)
bac.3
physeq.prune.rarefy100 = prune_taxa(taxa_sums(physeq.prune.rarefy) > 100, physeq.prune.rarefy)
physeq.prune.rarefy100
glom.bac <- tax_glom(physeq.prune.rarefy100,taxrank = "Class")
glom.bac
glom.bac <- tax_glom(bac3,taxrank = "Class")
glom.bac <- tax_glom(bac.3,taxrank = "Class")
glom.bac
glom.bac <- tax_glom(bac.3,taxrank = "Phylum")
glom.bac
tax_table(glom.bac)
bac.abund <- merge_samples(glom.bac, "Layer")
sample_data(bac.abund)$Layer <- factor(sample_names(bac.abund))
bac.abund = transform_sample_counts(bac.abund, function(x) x / sum(x))
bac.abund
data_glom.bac <- psmelt(bac.abund)
data_glom.bac$Phylum <- as.character(data_glom.bac$Phylum)
data_glom.bac.arc <- data_glom.bac
data_glom.bac.arc
data_glom.bac$Phylum[data_glom.bac$Abundance < 0.01] <- "<1% abund."
Count = length(unique(data_glom.bac$Phylum))
Count
unique((data_glom.bac$Phylum))
data_glom.bac$Phylum <- factor(data_glom.bac$Phylum, levels = c("D_1__Cyanobacteria","D_1__Proteobacteria","D_1__Actinobacteria","D_1__Acidobacteria","D_1__Chloroflexi","D_1__Bacteroidetes","D_1__Planctomycetes","D_1__Thaumarchaeota","D_1__Gemmatimonadetes","D_1__Verrucomicrobia","Unknown","D_1__Armatimonadetes","<1% abund."))
taxcom_layer = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_manual(values = c("brown","coral1","goldenrod","khaki1","lightgreen","darkturquoise","lightblue","midnightblue","aquamarine4","lavenderblush2","hotpink2", "snow3", "black"))
print(taxcom_layer)
data_glom.bac$Layer = factor(data_glom.bac&Layer, levels = c("Surface", "Subsurface"))
data_glom.bac$Layer = factor(data_glom.bac$Layer, levels = c("Surface", "Subsurface"))
taxcom_layer = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_manual(values = c("brown","coral1","goldenrod","khaki1","lightgreen","darkturquoise","lightblue","midnightblue","aquamarine4","lavenderblush2","hotpink2", "snow3", "black"))
print(taxcom_layer)
taxcom_layer_pl = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_brewer(palette="Set1"))
taxcom_layer_pl = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_brewer(palette="Set1")
print(taxcom_layer_pl)
taxcom_layer_pl = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_brewer(palette="Set3")
print(taxcom_layer_pl)
taxcom_layer_pl = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_brewer(palette="Accent")
print(taxcom_layer_pl)
taxcom_layer_pl = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_brewer(palette="Accent","Set2")
print(taxcom_layer_pl)
# The palette with black:
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
taxcom_layer_pl = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_manual(values = "cbbPalette")
print(taxcom_layer_pl)
# The palette with black:
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
taxcom_layer_pl = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_manual(values = cbbPalette)
print(taxcom_layer_pl)
# The palette with black:
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "midnightblue", "lightgreen", "aquamarine4","lavenderblush2","hotpink2", "snow3")
taxcom_layer_pl = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_manual(values = cbbPalette)
print(taxcom_layer_pl)
# The palette with black:
cbbPalette <- c("#009E73","#000000", "#E69F00", "#56B4E9", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "midnightblue", "lightgreen", "aquamarine4","lavenderblush2","hotpink2", "snow3")
taxcom_layer_pl = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_manual(values = cbbPalette)
print(taxcom_layer_pl)
# The palette with black:
col_vector<-c('#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4', '#46f0f0', '#f032e6', '#bcf60c', '#fabebe', '#008080', '#e6beff', '#9a6324', '#fffac8', '#800000', '#aaffc3', '#808000', '#ffd8b1', '#000075', '#808080', '#ffffff', '#000000')
taxcom_layer_pl = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_manual(values = col_vector)
print(taxcom_layer_pl)
# The palette with black:
cbbPalette <- c("#009E73","#000000", "#E69F00", "#56B4E9", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "midnightblue", "lightgreen", "aquamarine4","lavenderblush2","hotpink2", "snow3")
taxcom_layer_pl = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_manual(values = cbbPalette)
print(taxcom_layer_pl)
# The palette with black:
cbbPalette <- c("#009E73","#999999", "#E69F00", "#56B4E9", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "midnightblue", "lightgreen", "aquamarine4","lavenderblush2","hotpink2", "snow3")
taxcom_layer_pl = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_manual(values = cbbPalette)
print(taxcom_layer_pl)
# The palette with black:
cbbPalette <- c("#009E73","#999999", "#E69F00", "#56B4E9", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "midnightblue", "lightgreen", "aquamarine4","lavenderblush2","brown", "snow3")
taxcom_layer_pl = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_manual(values = cbbPalette)
print(taxcom_layer_pl)
otus <- read.table("MojaveBacQ2FWLEsilva515806.otu_table.fix.txt",
header=T,sep="\t",row.names = 1)
otus <- read.table("MojaveBacQ2FWLEsilva515806.otu_table.fix.txt",
header=T,sep="\t",row.names = 1)
otumat <- as(as.matrix(otus), "matrix")
OTU = otu_table(otumat, taxa_are_rows = TRUE)
taxmat <- read.csv("taxonomy_phyloseq_fix_copy.csv",
sep=",",row.names=1)
#row.names(taxmat) = taxmat$OTU.ID
taxmat <- as(as.matrix(taxmat),"matrix")
TAX = tax_table(taxmat)
treefile = "tree.nwk"
tree = read.tree(treefile)
meta = read.table("Mojave_mappingfile_8-Aug-2018.txt",
header=TRUE,row.names=1,
sep="\t",stringsAsFactors=FALSE)
#meta <- meta[which(meta$Layer %in% c("Surface")),]
sampleData <- sample_data(meta)
physeq = phyloseq(OTU,TAX,sampleData,tree)
physeq
physeq.prune = prune_taxa(taxa_sums(physeq) > 5, physeq)
physeq.prune
readcount = data.table(as(sample_data(physeq.prune), "data.frame"),
TotalReads = sample_sums(physeq.prune),
keep.rownames = TRUE)
setnames(readcount, "rn", "SampleID")
#For plotting, use command below.
#SeqDepth = ggplot(readcount, aes(TotalReads)) + geom_histogram() + ggtitle("Sequencing Depth")
readcount = readcount[order(readcount$TotalReads), c("SampleID", "TotalReads")]
head(readcount)
head(readcount)
set.seed(711)
physeq.prune.rarefy = rarefy_even_depth(physeq.prune, sample.size = 37435, replace = FALSE, trimOTUs = TRUE)
physeq.prune.rarefy
tax.bac <- as(tax_table(physeq.prune.rarefy),"matrix")
head(tax.bac)
tax.bac[is.na(tax.bac)] <- "Unknown"
head(tax.bac)
TAX.bac <- tax_table(tax.bac)
bac.3 <- phyloseq(sample_data(physeq.prune.rarefy),otu_table(physeq.prune.rarefy),TAX.bac)
bac.3
glom.bac <- tax_glom(bac.3,taxrank = "Phylum")
glom.bac
tax_table(glom.bac)
bac.abund <- merge_samples(glom.bac, "Layer")
sample_data(bac.abund)$Layer <- factor(sample_names(bac.abund))
bac.abund = transform_sample_counts(bac.abund, function(x) x / sum(x))
bac.abund
data_glom.bac <- psmelt(bac.abund)
data_glom.bac$Phylum <- as.character(data_glom.bac$Phylum)
data_glom.bac$Phylum[data_glom.bac$Abundance < 0.01] <- "<1% abund."
Count = length(unique(data_glom.bac$Phylum))
Count
unique((data_glom.bac$Phylum))
unique((data_glom.bac$Phylum))
data_glom.bac$Phylum <- factor(data_glom.bac$Phylum, levels = c("D_1__Cyanobacteria","D_1__Proteobacteria","D_1__Actinobacteria","D_1__Acidobacteria","D_1__Chloroflexi","D_1__Bacteroidetes","D_1__Planctomycetes","D_1__Thaumarchaeota","D_1__Gemmatimonadetes","D_1__Verrucomicrobia","Unknown","D_1__Armatimonadetes","<1% abund."))
data_glom.bac$Layer = factor(data_glom.bac$Layer, levels = c("Surface", "Subsurface"))
data_glom.bac$Phylum <- factor(data_glom.bac$Phylum, levels = c("Cyanobacteria","Proteobacteria","Actinobacteria","Acidobacteria","Chloroflexi","Bacteroidetes","Planctomycetes","Thaumarchaeota","Gemmatimonadetes","Verrucomicrobia","Unknown","Armatimonadetes","<1% abund."))
data_glom.bac$Layer = factor(data_glom.bac$Layer, levels = c("Surface", "Subsurface"))
# The palette with black:
cbbPalette <- c("#009E73","#999999", "#E69F00", "#56B4E9", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "midnightblue", "lightgreen", "aquamarine4","lavenderblush2","brown", "snow3")
taxcom_layer_pl = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_manual(values = cbbPalette)
print(taxcom_layer_pl)
unique((data_glom.bac$Phylum))
data_glom.bac <- psmelt(bac.abund)
data_glom.bac$Phylum <- as.character(data_glom.bac$Phylum)
data_glom.bac$Phylum[data_glom.bac$Abundance < 0.01] <- "<1% abund."
Count = length(unique(data_glom.bac$Phylum))
Count
unique((data_glom.bac$Phylum))
data_glom.bac$Phylum <- factor(data_glom.bac$Phylum, levels = c("Cyanobacteria","Proteobacteria","Actinobacteria","Acidobacteria","Chloroflexi","Bacteroidetes","Planctomycetes","Thaumarchaeota","Gemmatimonadetes","Verrucomicrobia","Unknown","Armatimonadetes","<1% abund."))
data_glom.bac$Layer = factor(data_glom.bac$Layer, levels = c("Surface", "Subsurface"))
# The palette with black:
cbbPalette <- c("#009E73","#999999", "#E69F00", "#56B4E9", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "midnightblue", "lightgreen", "aquamarine4","lavenderblush2","brown", "snow3")
taxcom_layer_pl = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_manual(values = cbbPalette)
print(taxcom_layer_pl)
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "Rhizaria")
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "Chromista")
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "D_0__Eukaryota")
physeq.prune.rarefy
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "Rhizaria")
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "Chromista")
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "Eukaryota")
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "Unassigned")
physeq.prune.rarefy
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "Rhizaria")
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "Chromista")
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "Eukaryota")
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "Unassigned")
physeq.prune.rarefy
tax.bac <- as(tax_table(physeq.prune.rarefy),"matrix")
head(tax.bac)
tax.bac[is.na(tax.bac)] <- "Unknown"
head(tax.bac)
TAX.bac <- tax_table(tax.bac)
bac.3 <- phyloseq(sample_data(physeq.prune.rarefy),otu_table(physeq.prune.rarefy),TAX.bac)
bac.3
glom.bac <- tax_glom(bac.3,taxrank = "Phylum")
glom.bac
tax_table(glom.bac)
bac.abund <- merge_samples(glom.bac, "Layer")
sample_data(bac.abund)$Layer <- factor(sample_names(bac.abund))
bac.abund = transform_sample_counts(bac.abund, function(x) x / sum(x))
bac.abund
data_glom.bac <- psmelt(bac.abund)
data_glom.bac$Phylum <- as.character(data_glom.bac$Phylum)
data_glom.bac$Phylum[data_glom.bac$Abundance < 0.01] <- "<1% abund."
Count = length(unique(data_glom.bac$Phylum))
Count
unique((data_glom.bac$Phylum))
data_glom.bac$Phylum <- factor(data_glom.bac$Phylum, levels = c("Cyanobacteria","Proteobacteria","Actinobacteria","Acidobacteria","Chloroflexi","Bacteroidetes","Planctomycetes","Thaumarchaeota","Gemmatimonadetes","Verrucomicrobia","Unknown","Armatimonadetes","<1% abund."))
data_glom.bac$Layer = factor(data_glom.bac$Layer, levels = c("Surface", "Subsurface"))
# The palette with black:
cbbPalette <- c("#009E73","#999999", "#E69F00", "#56B4E9", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "midnightblue", "lightgreen", "aquamarine4","lavenderblush2","brown", "snow3")
taxcom_layer_pl = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_manual(values = cbbPalette)
print(taxcom_layer_pl)
png("./Figures/Fig4A_Bacterial_Taxonomic_Composition_(Phylum_level)_by_Layer_reorder_not_Rainbow.png", units="in", width = 8, height = 5.8, res = 300 )
taxcom_layer_pl
dev.off()
png("./Figures/Fig4A_Bacterial_Taxonomic_Composition_(Phylum_level)_by_Layer_reorder_not_Rainbow.png", units="in", width = 5.8, height = 5.8, res = 300 )
taxcom_layer_pl
dev.off()
otus <- read.table("MojaveBacQ2FWLEsilva515806.otu_table.fix.txt",
header=T,sep="\t",row.names = 1)
otumat <- as(as.matrix(otus), "matrix")
OTU = otu_table(otumat, taxa_are_rows = TRUE)
taxmat <- read.csv("taxonomy_phyloseq_fix_copy.csv",
sep=",",row.names=1)
#row.names(taxmat) = taxmat$OTU.ID
taxmat <- as(as.matrix(taxmat),"matrix")
TAX = tax_table(taxmat)
treefile = "tree.nwk"
tree = read.tree(treefile)
meta = read.table("Mojave_mappingfile_8-Aug-2018.txt",
header=TRUE,row.names=1,
sep="\t",stringsAsFactors=FALSE)
#meta <- meta[which(meta$Layer %in% c("Surface")),]
sampleData <- sample_data(meta)
physeq = phyloseq(OTU,TAX,sampleData,tree)
physeq
physeq.prune = prune_taxa(taxa_sums(physeq) > 5, physeq)
physeq.prune
readcount = data.table(as(sample_data(physeq.prune), "data.frame"),
TotalReads = sample_sums(physeq.prune),
keep.rownames = TRUE)
setnames(readcount, "rn", "SampleID")
#For plotting, use command below.
#SeqDepth = ggplot(readcount, aes(TotalReads)) + geom_histogram() + ggtitle("Sequencing Depth")
readcount = readcount[order(readcount$TotalReads), c("SampleID", "TotalReads")]
head(readcount)
set.seed(711)
physeq.prune.rarefy = rarefy_even_depth(physeq.prune, sample.size = 37435, replace = FALSE, trimOTUs = TRUE)
physeq.prune.rarefy
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "Rhizaria")
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "Chromista")
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "Eukaryota")
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "Unassigned")
physeq.prune.rarefy
physeq.prune.rarefy.SF = subset_samples(physeq.prune.rarefy, Layer=="Surface")
tax.bac <- as(tax_table(physeq.prune.rarefy.SF),"matrix")
head(tax.bac)
tax.bac[is.na(tax.bac)] <- "Unknown"
head(tax.bac)
TAX.bac <- tax_table(tax.bac)
bac.3 <- phyloseq(sample_data(physeq.prune.rarefy.SF),otu_table(physeq.prune.rarefy.SF),TAX.bac)
bac.3
glom.bac <- tax_glom(bac.3,taxrank = "Phylum")
glom.bac
tax_table(glom.bac)
bac.abund <- merge_samples(glom.bac, "Site")
sample_data(bac.abund)$Layer <- factor(sample_names(bac.abund))
bac.abund = transform_sample_counts(bac.abund, function(x) x / sum(x))
bac.abund
data_glom.bac <- psmelt(bac.abund)
data_glom.bac$Phylum <- as.character(data_glom.bac$Phylum)
data_glom.bac$Phylum[data_glom.bac$Abundance < 0.01] <- "<1% abund."
Count = length(unique(data_glom.bac$Phylum))
Count
unique((data_glom.bac$Phylum))
unique((data_glom.bac$Phylum))
data_glom.bac$Phylum <- factor(data_glom.bac$Phylum, levels = c("Cyanobacteria","Proteobacteria","Actinobacteria","Bacteroidetes","Acidobacteria","Unknown", "Chloroflexi","Planctomycetes","Gemmatimonadetes","Verrucomicrobia","<1% abund."))
data_glom.bac$Layer = factor(data_glom.bac$Layer, levels = c("CIMA", "KELSO", "GMT", "JTNP"))
# The palette with black:
cbbPalette <- c("#009E73","#999999", "#E69F00", "#56B4E9", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "midnightblue", "lightgreen", "aquamarine4","lavenderblush2","brown", "snow3")
taxcom_layer_pl = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_manual(values = cbbPalette)
print(taxcom_layer_pl)
png("./Figures/FigS2A_Bacterial_Taxonomic_Composition_(Phylum_level)_by_Site_reorder_not_Rainbow.png", units="in", width = 5.8, height = 5.8, res = 300 )
taxcom_layer_pl
dev.off()
otus <- read.table("MojaveBacQ2FWLEsilva515806.otu_table.fix.txt",
header=T,sep="\t",row.names = 1)
otumat <- as(as.matrix(otus), "matrix")
OTU = otu_table(otumat, taxa_are_rows = TRUE)
taxmat <- read.csv("taxonomy_phyloseq_fix_copy.csv",
sep=",",row.names=1)
#row.names(taxmat) = taxmat$OTU.ID
taxmat <- as(as.matrix(taxmat),"matrix")
TAX = tax_table(taxmat)
treefile = "tree.nwk"
tree = read.tree(treefile)
meta = read.table("Mojave_mappingfile_8-Aug-2018.txt",
header=TRUE,row.names=1,
sep="\t",stringsAsFactors=FALSE)
#meta <- meta[which(meta$Layer %in% c("Surface")),]
sampleData <- sample_data(meta)
physeq = phyloseq(OTU,TAX,sampleData,tree)
physeq
physeq.prune = prune_taxa(taxa_sums(physeq) > 5, physeq)
physeq.prune
readcount = data.table(as(sample_data(physeq.prune), "data.frame"),
TotalReads = sample_sums(physeq.prune),
keep.rownames = TRUE)
setnames(readcount, "rn", "SampleID")
#For plotting, use command below.
#SeqDepth = ggplot(readcount, aes(TotalReads)) + geom_histogram() + ggtitle("Sequencing Depth")
readcount = readcount[order(readcount$TotalReads), c("SampleID", "TotalReads")]
head(readcount)
set.seed(711)
physeq.prune.rarefy = rarefy_even_depth(physeq.prune, sample.size = 37435, replace = FALSE, trimOTUs = TRUE)
physeq.prune.rarefy
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "Rhizaria")
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "Chromista")
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "Eukaryota")
physeq.prune.rarefy = subset_taxa(physeq.prune.rarefy, Kingdom != "Unassigned")
physeq.prune.rarefy
physeq.prune.rarefy.SF = subset_samples(physeq.prune.rarefy, Layer=="Surface")
tax.bac <- as(tax_table(physeq.prune.rarefy),"matrix")
head(tax.bac)
tax.bac[is.na(tax.bac)] <- "Unknown"
head(tax.bac)
TAX.bac <- tax_table(tax.bac)
bac.3 <- phyloseq(sample_data(physeq.prune.rarefy),otu_table(physeq.prune.rarefy),TAX.bac)
bac.3
tax.bac <- as(tax_table(physeq.prune.rarefy.SF),"matrix")
head(tax.bac)
tax.bac[is.na(tax.bac)] <- "Unknown"
head(tax.bac)
TAX.bac <- tax_table(tax.bac)
bac.3 <- phyloseq(sample_data(physeq.prune.rarefy.SF),otu_table(physeq.prune.rarefy.SF),TAX.bac)
bac.3
glom.bac <- tax_glom(bac.3,taxrank = "Phylum")
glom.bac
tax_table(glom.bac)
bac.abund <- merge_samples(glom.bac, "Crust_type")
sample_data(bac.abund)$Layer <- factor(sample_names(bac.abund))
bac.abund = transform_sample_counts(bac.abund, function(x) x / sum(x))
bac.abund
data_glom.bac <- psmelt(bac.abund)
data_glom.bac$Phylum <- as.character(data_glom.bac$Phylum)
data_glom.bac$Phylum[data_glom.bac$Abundance < 0.01] <- "<1% abund."
Count = length(unique(data_glom.bac$Phylum))
Count
unique((data_glom.bac$Phylum))
unique((data_glom.bac$Phylum))
data_glom.bac$Phylum <- factor(data_glom.bac$Phylum, levels = c("Cyanobacteria","Proteobacteria","Actinobacteria","Bacteroidetes","Unknown","Acidobacteria","Chloroflexi","Planctomycetes","Gemmatimonadetes","Verrucomicrobia","<1% abund."))
data_glom.bac$Layer = factor(data_glom.bac$Layer, levels = c("LAC", "CLC", "GLC", "RMC", "SMC"))
# The palette with black:
cbbPalette <- c("#009E73","#999999", "#E69F00", "#56B4E9", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "midnightblue", "lightgreen", "aquamarine4","lavenderblush2","brown", "snow3")
taxcom_layer_pl = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Layer")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_manual(values = cbbPalette)
print(taxcom_layer_pl)
# The palette with black:
cbbPalette <- c("#009E73","#999999", "#E69F00", "#56B4E9", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "midnightblue", "lightgreen", "aquamarine4","lavenderblush2","brown", "snow3")
taxcom_layer_pl = ggplot(data = data_glom.bac, mapping = aes_string(x = "Layer" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Bacterial Taxonomic Composition (Phylum level) by Crust type")+
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_fill_manual(values = cbbPalette)
print(taxcom_layer_pl)
png("./Figures/FigS2A_Bacterial_Taxonomic_Composition_(Phylum_level)_by_Crust_type_reorder_not_Rainbow.png", units="in", width = 5.8, height = 5.8, res = 300 )
taxcom_layer_pl
dev.off()
