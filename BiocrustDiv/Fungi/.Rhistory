knitr::opts_chunk$set(echo = TRUE)
library(ape)
library(vegan)
library(dplyr)
library(scales)
library(grid)
library(reshape2)
library(phyloseq)
library(magrittr)
library(ggplot2)
library(ggpubr)
library(plyr)
library(data.table)
library(tidyr)
library(tidyverse)
meta = read.table("Mojave_mappingfile_8-Aug-2018.txt",header=TRUE,row.names=1,sep="\t",stringsAsFactors=FALSE)
#meta <- meta[which(meta$Layer %in% c("Surface")),]
head(meta)
sampleData <- sample_data(meta)
otus <- read.table("MC2018FC.otu_table.txt",header=T,sep="\t",row.names=1)
otumat <- as(as.matrix(otus), "matrix")
OTU = otu_table(otumat, taxa_are_rows = TRUE)
head(OTU)
taxmat <- read.table("MC2018FC.taxonomy.fix.txt", header=T,sep="\t",row.names=1)
taxmat <- as(as.matrix(taxmat),"matrix")
TAX = tax_table(taxmat)
treefile = "MC2018FC.tree.phy"
tree = read.tree(treefile)
physeq = phyloseq(OTU,TAX,sampleData,tree)
physeq
physeq.prune = prune_taxa(taxa_sums(physeq) > 1, physeq)
physeq.prune
readcount = data.table(as(sample_data(physeq.prune), "data.frame"),
TotalReads = sample_sums(physeq.prune),
keep.rownames = TRUE)
setnames(readcount, "rn", "SampleID")
#For plotting, use command below.
#SeqDepth = ggplot(readcount, aes(TotalReads)) + geom_histogram() + ggtitle("Sequencing Depth")
readcount = readcount[order(readcount$TotalReads), c("SampleID", "TotalReads")]
head(readcount)
set.seed(1)
physeq.prune.rarefy = rarefy_even_depth(physeq.prune, sample.size = 6842, replace = FALSE, trimOTUs = FALSE)
physeq.prune.rarefy
physeq.prune.rarefy.ps.plot.richness.site.layer = plot_richness(physeq.prune.rarefy, x="Site_layer", color=("Site_layer"), measures=c("Observed")) + geom_boxplot() + ggtitle("Mojave Biocrust Fungal Alpha Diversity (Observed) by Site and Layer") + stat_compare_means(method = "anova", label.y = 400) + stat_compare_means(aes(label=..p.signif..), method = "t.test", ref.group = "GMT_Sub", label.y = 380, hide.ns = TRUE) + theme_bw() + theme(plot.title = element_text(hjust = 0.5))
physeq.prune.rarefy.ps.plot.richness.site.layer
physeq.prune.rarefy.SF = subset_samples(physeq.prune.rarefy, Layer=="Surface")
sample_data(physeq.prune.rarefy.SF)$Site = factor(sample_data(physeq.prune.rarefy.SF)$Site, levels = c("JTNP","CIMA", "GMT", "KELSO"))
alpha.diversity = estimate_richness(physeq.prune.rarefy.SF, measures = c("Observed"))
data.anova = cbind(sample_data(physeq.prune.rarefy.SF), alpha.diversity)
physeq.prune.rarefy.SF.anova = aov(Observed ~ Site, data.anova)
summary(physeq.prune.rarefy.SF.anova)
physeq.prune.rarefy.SF = subset_samples(physeq.prune, Layer=="Surface")
sample_data(physeq.prune.rarefy.SF)$Site = factor(sample_data(physeq.prune.rarefy.SF)$Site, levels = c("JTNP","CIMA", "GMT", "KELSO"))
alpha.diversity = estimate_richness(physeq.prune.rarefy.SF, measures = c("Observed"))
data.anova = cbind(sample_data(physeq.prune.rarefy.SF), alpha.diversity)
physeq.prune.rarefy.SF.anova = aov(Observed ~ Site, data.anova)
summary(physeq.prune.rarefy.SF.anova)
tukey.ps.SF = TukeyHSD(x=physeq.prune.rarefy.SF.anova, 'Site', conf.level = 0.95)
generate_label_df <- function(tukey.ps.SF, variable){
# Extract labels and factor levels from Tukey post-hoc
Tukey.levels <- tukey.ps.SF[[variable]][,4]
Tukey.labels <- data.frame(multcompLetters(Tukey.levels)['Letters'])
#I need to put the labels in the same order as in the boxplot :
Tukey.labels$treatment=rownames(Tukey.labels)
Tukey.labels=Tukey.labels[order(Tukey.labels$treatment) , ]
return(Tukey.labels)
}
LABELS=generate_label_df(tukey.ps.SF, 'Site')
library(multcompView)
LABELS=generate_label_df(tukey.ps.SF, 'Site')
names(LABELS) = c('Letters','Site')
physeq.prune.rarefy.plot.richness.Site_layer = plot_richness(physeq.prune.rarefy.SF, x="Site", color=("Site"), measures=c("Observed")) + geom_boxplot(lwd=1,fill=c("#999999", "gold2", "cadetblue3", "palegreen2")) + ggtitle("Bacterial Alpha Diversity by Site") + stat_compare_means(method = "anova", label.y = 1222) + theme(plot.title = element_text(hjust = 0.5)) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73")) + geom_text(data=LABELS, aes(x=LABELS$Site, y = 1150, label = LABELS$Letters))
physeq.prune.rarefy.plot.richness.Site_layer
physeq.prune.rarefy.plot.richness.Site_layer = plot_richness(physeq.prune.rarefy.SF, x="Site", color=("Site"), measures=c("Observed")) + geom_boxplot(lwd=1,fill=c("#999999", "gold2", "cadetblue3", "palegreen2")) + ggtitle("Bacterial Alpha Diversity by Site") + stat_compare_means(method = "anova", label.y = 500) + theme(plot.title = element_text(hjust = 0.5)) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73")) + geom_text(data=LABELS, aes(x=LABELS$Site, y = 500, label = LABELS$Letters))
physeq.prune.rarefy.plot.richness.Site_layer
physeq.prune.rarefy.plot.richness.Site_layer = plot_richness(physeq.prune.rarefy.SF, x="Site", color=("Site"), measures=c("Observed")) + geom_boxplot(lwd=1,fill=c("#999999", "gold2", "cadetblue3", "palegreen2")) + ggtitle("Bacterial Alpha Diversity by Site") + stat_compare_means(method = "anova", label.y = 510) + theme(plot.title = element_text(hjust = 0.5)) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73")) + geom_text(data=LABELS, aes(x=LABELS$Site, y = 500, label = LABELS$Letters))
physeq.prune.rarefy.plot.richness.Site_layer
physeq.prune.rarefy.plot.richness.Site_layer = plot_richness(physeq.prune.rarefy.SF, x="Site", color=("Site"), measures=c("Observed")) + geom_boxplot(lwd=1,fill=c("#999999", "gold2", "cadetblue3", "palegreen2")) + ggtitle("Bacterial Alpha Diversity by Site") + stat_compare_means(method = "anova", label.y = 520) + theme(plot.title = element_text(hjust = 0.5)) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73")) + geom_text(data=LABELS, aes(x=LABELS$Site, y = 500, label = LABELS$Letters))
physeq.prune.rarefy.plot.richness.Site_layer
pdf("./Figures/Fungal Alpha Diversity by Site.pdf", width = 8, height = 5)
physeq.prune.rarefy.ps.plot.richness.site.layer
dev.off()
pdf("./Figures/Fungal Alpha Diversity by Site.pdf", width = 8, height = 5)
physeq.prune.rarefy.plot.richness.site.layer
pdf("./Figures/Fungal Alpha Diversity by Site.pdf", width = 8, height = 5)
physeq.prune.rarefy.plot.richness.site_layer
pdf("./Figures/Fungal Alpha Diversity by Site.pdf", width = 8, height = 5)
physeq.prune.rarefy.plot.richness.Site_layer
dev.off()
physeq.prune.rarefy.plot.richness.Site_layer = plot_richness(physeq.prune.rarefy.SF, x="Site", color=("Site"), measures=c("Observed")) + geom_boxplot(lwd=1,fill=c("#999999", "gold2", "cadetblue3", "palegreen2")) + ggtitle("Fungal Alpha Diversity by Site") + stat_compare_means(method = "anova", label.y = 520) + theme(plot.title = element_text(hjust = 0.5)) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73")) + geom_text(data=LABELS, aes(x=LABELS$Site, y = 500, label = LABELS$Letters))
physeq.prune.rarefy.plot.richness.Site_layer
pdf("./Figures/Fungal Alpha Diversity by Site.pdf", width = 8, height = 5)
physeq.prune.rarefy.plot.richness.Site_layer
dev.off()
taxcom_site = ggplot(data = psmelt(physeq.prune.rarefy.SF), mapping = aes_string(x = "Site" ,y = "Abundance", fill = "Phylum" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Fungal Taxonomic Composition by Site")+
theme(axis.text.x = element_text(angle = 90, hjust = 1))+
theme(plot.title = element_text(hjust = 0.5))
#print(taxcom_sitelayer)
pdf("./Figures/Fungal Taxonomic Composition by Site.pdf", width = 10, height = 6 )
taxcom_site
dev.off()
taxcom_site = ggplot(data = psmelt(physeq.prune.rarefy.SF), mapping = aes_string(x = "Site" ,y = "Abundance", fill = "Class" )) +
geom_bar(stat="identity", position="fill") +
ggtitle("Fungal Taxonomic Composition by Site")+
theme(axis.text.x = element_text(angle = 90, hjust = 1))+
theme(plot.title = element_text(hjust = 0.5))
#print(taxcom_sitelayer)
pdf("./Figures/Fungal Taxonomic Composition by Site.pdf", width = 10, height = 6 )
taxcom_site
dev.off()
FungiClass = as.character(get_taxa_unique(physeq.prune.rarefy.SF, "Class"))
FungiClass = FungiClass[complete.cases(FungiClass)]
pdf("./Figures/Fungal Class Alpha Diversity Observed by Site PLPA250.pdf", width = 8, height = 5 )
for (i in FungiClass) {
APS = subset_taxa(physeq.prune.rarefy, Class == i)
APS.plot = plot_richness(APS, x="Site", color =("Site"), measures=c("Observed")) + geom_boxplot(lwd=1,fill=c("#999999", "gold2", "cadetblue3", "palegreen2")) + ggtitle(i) + stat_compare_means(method = "anova") + theme(plot.title = element_text(hjust = 0.5)) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73"))
print(APS.plot)
}
pdf("./Figures/Fungal Class Alpha Diversity Observed by Site PLPA250.pdf", width = 8, height = 5 )
for (i in FungiClass) {
APS = subset_taxa(physeq.prune.rarefy.SF, Class == i)
APS.plot = plot_richness(APS, x="Site", color =("Site"), measures=c("Observed")) + geom_boxplot(lwd=1,fill=c("#999999", "gold2", "cadetblue3", "palegreen2")) + ggtitle(i) + stat_compare_means(method = "anova") + theme(plot.title = element_text(hjust = 0.5)) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73"))
print(APS.plot)
}
dev.off()
knitr::opts_chunk$set(echo = TRUE)
library(ape)
library(vegan)
library(dplyr)
library(scales)
library(grid)
library(reshape2)
library(phyloseq)
library(magrittr)
library(ggplot2)
library(ggpubr)
library(plyr)
library(data.table)
library(tidyr)
library(tidyverse)
meta = read.table("Mojave_mappingfile_8-Aug-2018.txt",header=TRUE,row.names=1,sep="\t",stringsAsFactors=FALSE)
sampleData <- sample_data(meta)
otus <- read.table("MC2018FC.otu_table.txt",header=T,sep="\t",row.names=1)
otumat <- as(as.matrix(otus), "matrix")
OTU = otu_table(otumat, taxa_are_rows = TRUE)
taxmat <- read.table("MC2018FC.taxonomy.fix.txt", header=T,sep="\t",row.names=1)
taxmat <- as(as.matrix(taxmat),"matrix")
TAX = tax_table(taxmat)
treefile = "MC2018FC.tree.phy"
tree = read.tree(treefile)
physeq = phyloseq(OTU,TAX,sampleData,tree)
physeq
physeq.prune = prune_taxa(taxa_sums(physeq) > 1, physeq)
physeq.prune
readcount = data.table(as(sample_data(physeq.prune), "data.frame"),
TotalReads = sample_sums(physeq.prune),
keep.rownames = TRUE)
setnames(readcount, "rn", "SampleID")
#For plotting, use command below.
#SeqDepth = ggplot(readcount, aes(TotalReads)) + geom_histogram() + ggtitle("Sequencing Depth")
readcount = readcount[order(readcount$TotalReads), c("SampleID", "TotalReads")]
head(readcount)
set.seed(1)
physeq.prune.rarefy = rarefy_even_depth(physeq.prune, sample.size = 6842, replace = FALSE, trimOTUs = FALSE)
physeq.prune.rarefy
physeq.prune.rarefy.SF = subset_samples(physeq.prune, Layer=="Surface")
sample_data(physeq.prune.rarefy.SF)$Site = factor(sample_data(physeq.prune.rarefy.SF)$Site, levels = c("LAC","CLC", "GLC", "RMC", "SMC"))
physeq.prune.rarefy.SF = subset_samples(physeq.prune, Layer=="Surface")
sample_data(physeq.prune.rarefy.SF)$Crust_type = factor(sample_data(physeq.prune.rarefy.SF)$Crust_type, levels = c("LAC","CLC", "GLC", "RMC", "SMC"))
alpha.diversity = estimate_richness(physeq.prune.rarefy.SF, measures = c("Observed"))
data.anova = cbind(sample_data(physeq.prune.rarefy.SF), alpha.diversity)
physeq.prune.rarefy.SF.anova = aov(Observed ~ Crust_type, data.anova)
summary(physeq.prune.rarefy.SF.anova)
tukey.ps.SF = TukeyHSD(x=physeq.prune.rarefy.SF.anova, 'Crust_type', conf.level = 0.95)
generate_label_df <- function(tukey.ps.SF, variable){
# Extract labels and factor levels from Tukey post-hoc
Tukey.levels <- tukey.ps.SF[[variable]][,4]
Tukey.labels <- data.frame(multcompLetters(Tukey.levels)['Letters'])
#I need to put the labels in the same order as in the boxplot :
Tukey.labels$treatment=rownames(Tukey.labels)
Tukey.labels=Tukey.labels[order(Tukey.labels$treatment) , ]
return(Tukey.labels)
}
LABELS=generate_label_df(tukey.ps.SF, 'Site')
library(multcompView)
LABELS=generate_label_df(tukey.ps.SF, 'Site')
LABELS=generate_label_df(tukey.ps.SF, 'Crust_type')
names(LABELS) = c('Letters','Crust_type')
physeq.prune.rarefy.plot.richness.Crust_type = plot_richness(physeq.prune.rarefy.SF, x="Crust_type", color=("Crust_type"), measures=c("Observed")) + geom_boxplot(lwd=1,fill=c("#999999", "gold2", "cadetblue3", "palegreen2", "lightpink")) + ggtitle("Fungal Alpha Diversity by Crust_type") + stat_compare_means(method = "anova", label.y = 520) + theme(plot.title = element_text(hjust = 0.5)) + scale_colour_manual(values = c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7")) + geom_text(data=LABELS, aes(x=LABELS$Crust_type, y = 500, label = LABELS$Letters))
physeq.prune.rarefy.plot.richness.Crust_type
pdf("./Figures/Fungal Alpha Diversity (Observed) by Crust_type.pdf", width = 8, height = 5)
physeq.prune.rarefy.plot.richness.Crust_type
dev.off()
